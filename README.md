# MSD-I dataset

## Fichier principal

Le fichier `msdi_mapping.csv` est le fichier principal, à partir duquel on 
peut charger toutes les données, et qui contient les informations relatives 
à chaque entrée, en particulier:

* chaque ligne correspond à un morceau
* la colonne `'genre'` contient le genre du morceau
* la colonne `'msd_track_id'` contient l'identifiant du morceau pour l'audio
* la colonne `'mfcc'` contient le nom du fichier dans lequel se trouve les 
descripteurs audio MFCC du morceau (voir détails ci-dessous)
* la colonne `'img'` contient le nom du fichier image
* la colonne `'deep_features'` contient l'indice du descripteur audio deep 
dans le tableau associé.

## Images

Les images se trouvent dans le sous répertoire `img`. Pour les charger à 
partir d'une ligne `entry` du fichier principal, on peut par exemple 
utiliser la fonction
```
from pathlib import Path

def load_img(entry, msdi_path):
    return plt.imread(Path(msdi_path) / entry['img'])
```
où `msdi_path` est le répertoire racine de la base de données.

## Descripteurs audio MFCC

Les fichiers contenant les MFCC se trouvent dans le répertoire `mfcc`, qui 
contient 26 fichiers `mfcc_x.npz` où `x` est une lettre de l'alphabet. 
Chaque morceau est associé à un tableau numpy de format `(n, d)` contenant les 
MFCC en dimention `d` extraits sur `n` trames. Pour économiser de l'espace 
de stockage, les tableaux ont été regroupés dans les 26 fichiers `mfcc_x
.npz`. La colonne `'mfcc'` du fichier principal `msdi_mapping.csv` indique 
quel fichier `mfcc_x.npz` contient le tableau de chaque entrée. En ouvrant 
ce fichier, on obtient un dictionnaire dont les clés sont les identifiants 
`'msd_track_id'` des morceaux et les valeurs sont les tableaux de MFCC.

Pour charger une matrice de MFCC à partir d'une ligne `entry` du fichier 
principal, on peut par exemple utiliser la fonction

```
def load_mfcc(entry, msdi_path):
    x = np.load(Path(msdi_path) / entry['mfcc'])
    return x[entry['msd_track_id']]

```

## Descripteurs audio deep

Les features audio appris avec un réseau profond se trouvent dans le 
répertoire `deep_features`. Les 3 fichiers `X_*_audio_MSD-I.npy` 
contiennent chacun un tableau numpy correspondant aux features des exemples de 
train/valid/test, chaque vecteur de features étant en dimension 2048. 

Le mapping avec le fichier principal se fait via les colonnes `'set'` (pour 
sélectionner un des 3 fichiers `X_*_audio_MSD-I.npy`) et `'deep_features'` 
(pour sélectionner la bonne ligne dans le tableau numpy). Pour charger un 
vecteur de descripteurs à partir d'une ligne `entry` du fichier principal, on 
peut par exemple utiliser la fonction

```
def load_deep_audio_features(entry, msdi_path):
    subset_file = 'X_{}_audio_MSD-I.npy'.format(entry['set'])
    x = np.load(Path(msdi_path) / 'deep_features' / subset_file, mmap_mode='r')
    idx = entry['deep_features']
    return x[idx, :]
```

## Labels
Le fichier `labels.csv` contient la liste des labels de genre, utile pour 
les numéroter dans un ordre fixé. On peut la charger dans une liste via la 
fonction
```
def get_label_list(msdi_path):
    df = pd.read_csv(Path(msdi_path) / 'labels.csv', header=None)
    return list(df.iloc[:, 0])
```